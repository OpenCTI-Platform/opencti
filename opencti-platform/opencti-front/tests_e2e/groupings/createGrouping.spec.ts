import { expect, test } from '../fixtures/baseFixtures';
import GroupingsPage from '../model/grouping.pageModel';
import GroupingFormPage from '../model/form/groupingForm.pageModel';
import GroupingDetailsPage from '../model/groupingDetails.pageModel';
import StixDomainObjectContentTabPage from '../model/StixDomainObjectContentTab.pageModel';

test('Create a new grouping', async ({ page }) => {
  const groupingsPage = new GroupingsPage(page);
  const groupingForm = new GroupingFormPage(page);
  const groupingDetails = new GroupingDetailsPage(page);
  const stixDomainObjectContentTab = new StixDomainObjectContentTabPage(page);

  // go to groupings
  await groupingsPage.goto();
  await expect(groupingsPage.getPage()).toBeVisible();
  // add a new grouping
  await groupingsPage.addNew();
  await groupingForm.nameField.fill('Test grouping e2e');
  await groupingForm.contextSelect.selectOption('unspecified');
  await groupingForm.submit();
  // open it
  await groupingsPage.getItemFromList('Test grouping e2e').click();
  await expect(groupingDetails.getPage()).toBeVisible();
  await expect(groupingDetails.getTitle('Test grouping e2e')).toBeVisible();
  // add content
  await groupingDetails.goToTab('Content');
  await expect(stixDomainObjectContentTab.getPage()).toBeVisible();
  await stixDomainObjectContentTab.editMainContent('Main content text');
  await stixDomainObjectContentTab.addFile('Test file');
  await expect(page.getByText('Write something awesome...')).toBeVisible();
  await stixDomainObjectContentTab.editFile('Test file.html', 'Test file content text');
  await stixDomainObjectContentTab.selectMainContent();
  await expect(page.getByText('Main content text')).toBeVisible();
  await stixDomainObjectContentTab.selectFile('Test file.html');
  await expect(page.getByText('Test file content text')).toBeVisible();
});
